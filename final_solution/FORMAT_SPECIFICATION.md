# Спецификация формата Submission

## ⚠️ ВАЖНО: Правильный формат

Submission файл должен иметь формат **ticker,p1,p2,...,p20**

### Правильный пример:
```csv
ticker,p1,p2,p3,p4,p5,p6,p7,p8,p9,p10,p11,p12,p13,p14,p15,p16,p17,p18,p19,p20
AFLT,0.51,0.52,0.48,0.50,0.53,0.49,0.51,0.52,0.50,0.51,0.52,0.50,0.51,0.49,0.50,0.51,0.52,0.48,0.50,0.53
SBER,0.49,0.53,0.51,0.50,0.52,0.48,0.50,0.51,0.49,0.50,0.51,0.49,0.50,0.52,0.51,0.50,0.49,0.53,0.51,0.50
GAZP,0.50,0.51,0.49,0.52,0.50,0.48,0.51,0.50,0.49,0.51,0.50,0.52,0.50,0.51,0.49,0.50,0.52,0.51,0.50,0.49
```

### ❌ Неправильный формат (старый):
```csv
ticker,date,return_1d,return_20d,prob_1d,prob_20d
AFLT,2024-09-09,-0.029,0.058,0.001,0.998
AFLT,2024-09-10,-0.020,0.090,0.001,0.998
```

## Требования к формату

### 1. Структура колонок
- **Первая колонка**: `ticker` - название тикера (строка)
- **Следующие 20 колонок**: `p1, p2, p3, ..., p20` - вероятности роста

### 2. Значения p1-p20
- **p1**: Вероятность роста цены на 1 день вперед
- **p2**: Вероятность роста цены на 2 дня вперед
- ...
- **p20**: Вероятность роста цены на 20 дней вперед

Каждое значение `pi` должно быть в диапазоне **[0, 1]**

### 3. Уникальность
- **Одна строка на тикер**
- Никаких дубликатов тикеров
- Никаких колонок с датами

### 4. Порядок
- Тикеры должны быть отсортированы (рекомендуется)
- Колонки строго в порядке: ticker, p1, p2, ..., p20

## Проверка формата

Используйте скрипт `test_format.py`:

```bash
python test_format.py submission.csv
```

Вывод при правильном формате:
```
✅ Формат submission корректен!
   Тикеров: 42
   Колонок: 21 (ticker + p1-p20)
   Пример первой строки:
   AFLT: p1=0.510, p2=0.520, ..., p20=0.530
```

## Интерпретация вероятностей

### Что означают вероятности?

- **p_i = 0.5**: Нейтральный прогноз (50% шанс роста)
- **p_i > 0.5**: Ожидается рост цены на день i
- **p_i < 0.5**: Ожидается падение цены на день i

Например:
- **p1 = 0.7**: 70% вероятность что цена вырастет завтра
- **p5 = 0.3**: 30% вероятность что цена вырастет через 5 дней (т.е. 70% вероятность падения)

### Как получаются вероятности?

Наша модель обучает 20 бинарных классификаторов:
- Таргет для дня i: `y_i = 1 if log_return_i > 0 else 0`
- Модель предсказывает: `p_i = P(y_i = 1) = P(return_i > 0)`

## Пример генерации submission

```python
from solution import FinancialForecaster

# Загрузка модели
model = FinancialForecaster()
model.load('trained_model.pkl')

# Генерация submission
submission = model.predict(
    'test_candles.csv',
    'test_news.csv',
    'submission.csv'
)

# Проверка формата
print(submission.head())
#   ticker    p1    p2    p3  ...   p20
# 0   AFLT  0.51  0.52  0.48  ...  0.53
# 1   GAZP  0.50  0.51  0.49  ...  0.49
# 2   SBER  0.49  0.53  0.51  ...  0.50

print(f"Форма: {submission.shape}")  # (N_tickers, 21)
print(f"Колонки: {list(submission.columns)}")
# ['ticker', 'p1', 'p2', ..., 'p20']
```

## FAQ

**Q: Почему одна строка на тикер, а не по датам?**
A: Задача - предсказать вероятности роста на 20 дней вперед для каждого тикера на последнюю доступную дату.

**Q: Что если у разных тикеров разные последние даты?**
A: Это нормально. Для каждого тикера берется его последняя дата и делаются предсказания на 20 дней вперед от этой даты.

**Q: Нужно ли предсказывать returns?**
A: Нет! Только вероятности (p1-p20). Returns не нужны в submission.

**Q: Могут ли вероятности быть ровно 0 или 1?**
A: Технически да, но на практике модели обычно дают значения в диапазоне [0.01, 0.99]. Если вы видите много 0.0 или 1.0, возможно есть проблема с моделью.
